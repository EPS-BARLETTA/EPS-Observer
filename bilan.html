<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Bilan â€¢ EPS Multiâ€‘Observer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./assets/style.css" />
  <script type="module">
    import {load, exportPDF} from './assets/app.js';
    const state = load();

    function render(){
      const box = document.getElementById('box'); box.innerHTML="";
      if(!(state.observations||[]).length){
        box.innerHTML = "<div class='muted'>Aucune observation enregistrÃ©e pour le moment.</div>"; return;
      }
      state.observations.forEach((o, i)=>{
        const row=document.createElement('div'); row.className='card';
        const meta=document.createElement('div'); meta.className='row';
        meta.innerHTML = `<div class='title'>${i+1}. ${o.apsa}</div><div class='muted'>${new Date(o.date).toLocaleString()}</div>`;
        const who=document.createElement('div'); who.className='muted'; who.textContent = `Obs: ${(o.observers||[]).join(", ")||"â€”"} â€¢ Groupe: ${(o.group||[]).join(", ")||"â€”"}`;
        const table=document.createElement('div');
        o.items.forEach(it=>{
          const r=document.createElement('div'); r.className='list-row';
          r.innerHTML = `<div>${it.text}</div><div class='muted'>+${it.pos} / -${it.neg} â€” ${it.level}</div>`;
          table.append(r);
        });
        const actions=document.createElement('div'); actions.className='row';
        const exp=document.createElement('button'); exp.className='btn btn-accent'; exp.textContent='ðŸ“„ Export PDF'; exp.onclick=()=>exportPDF(o);
        actions.append(exp);
        row.append(meta, who, table, actions);
        box.append(row);
      });
    }
    window.addEventListener('DOMContentLoaded', render);
  </script>
</head>
<body>
<div class="app">
  <header class="header">
    <a class="btn btn-gray" href="./index.html">Accueil</a>
    <a class="btn btn-gray" href="./activity.html">Nouvelle activitÃ©</a>
  </header>
  <main class="main">
    <section class="section">
      <div class="pageTitle">
        <h1>Bilan â€” Observations enregistrÃ©es</h1>
        <div class="sub">Exporter en PDF (nom du fichier inclut les observateurs via le dialogue iPad)</div>
      </div>
      <div id="box"></div>
    </section>
  </main>
  <footer class="footer">EPS Multiâ€‘Observer â€” PDF via impression native iPad (AirDrop/Fichiers)</footer>
</div>
</body>
</html>
